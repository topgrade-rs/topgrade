on:
  release:
    types: [published, edited]

name: Check SemVer compliance

permissions:
  contents: read

jobs:
  prepare:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5.0.0

  semver:
    runs-on: ubuntu-latest
    steps:
      - run: cargo install --git https://github.com/rust-lang/rust-semverver
      - run: eval "current_version=$(grep -e '^version = .*$' Cargo.toml | cut -d ' ' -f 3)"
      - run: cargo semver | tee semver_out
      - run: (head -n 1 semver_out | grep "\-> $current_version") || (echo "versioning mismatch" && return 1)
